<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ClearMap Image Analysis Tools &mdash; ClearMap 0.9.2 documentation</title>
    
    <link rel="stylesheet" href="_static/clearmap.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="top" title="ClearMap 0.9.2 documentation" href="index.html" />
    <link rel="next" title="ClearMap package" href="api/ClearMap.html" />
    <link rel="prev" title="Tutorial" href="tutorial.html" />
 
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>


  </head>
  <body role="document">
<div style="background-color: #e2e8e9; text-align: left; padding: 10px 10px 15px 15px">
<p style="font-size: 30px; color: color: #11557C"> <a href="index.html" style="color: #11557C; font-weight: bold">ClearMap iDISCO+ Toolbox Documentation</a></p>
<a href="index.html"><img src="_static/brain_bw_small.jpg" height=50px width=150% border="0" alt="ClearMap"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api/ClearMap.html" title="ClearMap package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             accesskey="P">previous</a> |</li>
       <li><a href="index.html">home</a>|&nbsp;</li>
       <li><a href="search.html">search</a>|&nbsp;</li>
       <li><a href="api/ClearMap.html">documentation </a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Overview of ClearMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">ClearMap Image Analysis Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-3d-images">Visualizing 3D Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tiled-plots">Tiled Plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#image-statistics">Image Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background-removal">Background Removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-filter">Image Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#maxima-detection">Maxima Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cell-shape-detection">Cell Shape Detection</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/ClearMap.html">ClearMap package</a></li>
</ul>
 
  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="previous chapter">Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api/ClearMap.html"
                        title="next chapter">ClearMap package</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/imageanalysis.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="clearmap-image-analysis-tools">
<h1>ClearMap Image Analysis Tools<a class="headerlink" href="#clearmap-image-analysis-tools" title="Permalink to this headline">¶</a></h1>
<p>Here we introduce the main image processing steps for the detection of nuclear-located signal with examples.</p>
<p>The data is a small region isolated from an iDISCO+ cleared mouse brain immunostained against c-fos. This small stack is included in the ClearMap package in the Test/Data/ImageAnalysis/ folder:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClearMap.IO</span> <span class="kn">as</span> <span class="nn">io</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClearMap.Settings</span> <span class="kn">as</span> <span class="nn">settings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">ClearMapPath</span><span class="p">,</span> \
<span class="gp">&gt;&gt;&gt; </span>                        <span class="s">&#39;Test/Data/ImageAnalysis/cfos-substack.tif&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="visualizing-3d-images">
<h2>Visualizing 3D Images<a class="headerlink" href="#visualizing-3d-images" title="Permalink to this headline">¶</a></h2>
<p>Large images in 3d are best viewed in specialized software, such as
<a class="reference external" href="http://www.bitplane.com/">Imaris</a> for 3D rendering or <a class="reference external" href="http://imagej.net/Welcome">ImageJ</a> to parse the stacks. For the full size data, it is recommended to open the stacks in ImageJ using the «&nbsp;virtual stack&nbsp;» mode.</p>
<p>In ClearMap we provide some basic visualization tools to inspect the 3d data
in the module <a class="reference internal" href="api/ClearMap.Visualization.html#module-ClearMap.Visualization.Plot" title="ClearMap.Visualization.Plot"><code class="xref py py-mod docutils literal"><span class="pre">ClearMap.Visualization.Plot</span></code></a>.</p>
<p>To load them run</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClearMap.Visualization.Plot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="section" id="tiled-plots">
<h3>Tiled Plots<a class="headerlink" href="#tiled-plots" title="Permalink to this headline">¶</a></h3>
<p>In our experience results of 3d image analysis is inspected most accurately
by plotting each horizontal plane in the image in tiles that are coupled for
zooming. Intermediate results from all the steps of the SpotDetection can also be written as image stacks and opened with ImageJ.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readData</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">26</span><span class="p">));</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-1.py">Source code</a>, <a class="reference external" href=".//imageanalysis-1.png">png</a>, <a class="reference external" href=".//imageanalysis-1.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-1.png" src="_images/imageanalysis-1.png" />
</div>
<p>To only plot a particular subregion its possible to specify the x,y,z range.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">));</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-2.py">Source code</a>, <a class="reference external" href=".//imageanalysis-2.png">png</a>, <a class="reference external" href=".//imageanalysis-2.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-2.png" src="_images/imageanalysis-2.png" />
</div>
<p>Sometimes inverse colors may be better:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>  <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">));</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-3.py">Source code</a>, <a class="reference external" href=".//imageanalysis-3.png">png</a>, <a class="reference external" href=".//imageanalysis-3.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-3.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-3.png" src="_images/imageanalysis-3.png" />
</div>
</div>
</div>
<div class="section" id="image-statistics">
<h2>Image Statistics<a class="headerlink" href="#image-statistics" title="Permalink to this headline">¶</a></h2>
<p>It is useful to gather some information about the image initially.
For larger images that don’t fit in memory in ClearMap
certain statistics can be gathered in parallel via the
module <a class="reference internal" href="api/ClearMap.ImageProcessing.html#module-ClearMap.ImageProcessing.ImageStatistics" title="ClearMap.ImageProcessing.ImageStatistics"><code class="xref py py-mod docutils literal"><span class="pre">ClearMap.ImageProcessing.ImageStatistics</span></code></a> module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClearMap.ImageProcessing.ImageStatistics</span> <span class="kn">as</span> <span class="nn">stat</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">stat</span><span class="o">.</span><span class="n">calculateStatistics</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;mean&#39;</span><span class="p">)</span>
<span class="go">2305.4042155294119</span>
</pre></div>
</div>
<p>To get more information about the progress use the <code class="docutils literal"><span class="pre">verbose</span></code> option</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">stat</span><span class="o">.</span><span class="n">calculateStatistics</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="go">ChunkSize: Estimated chunk size 51 in 1 chunks!</span>
<span class="go">Number of SubStacks: 1</span>
<span class="go">Process 0: processing substack 0/1</span>
<span class="go">Process 0: file          = /ClearMap/Test/Data/ImageAnalysis/cfos-substack.tif</span>
<span class="go">Process 0: segmentation  = &lt;function calculateStatisticsOnStack at 0x7fee9c25dd70&gt;</span>
<span class="go">Process 0: ranges: x,y,z = &lt;built-in function all&gt;,&lt;built-in function all&gt;,(0, 51)</span>
<span class="go">Process 0: Reading data of size (250, 250, 51): elapsed time: 0:00:00</span>
<span class="go">Process 0: Processing substack of size (250, 250, 51): elapsed time: 0:00:00</span>
<span class="go">Total Time Image Statistics: elapsed time: 0:00:00</span>
<span class="go">2305.4042155294119</span>
</pre></div>
</div>
<p>Image statistics can be very helpful for modules, such as Ilastik, requiring a different bit depth than the original 16 or 12 bits files, as it helps to determine how to resample the images to a lower bit depth.</p>
</div>
<div class="section" id="background-removal">
<h2>Background Removal<a class="headerlink" href="#background-removal" title="Permalink to this headline">¶</a></h2>
<p>One of the first steps is often to remove background variations. The
<code class="xref py py-mod docutils literal"><span class="pre">ClearMap.Imageprocessing.BackgroundRemoval</span></code> module can be used. It performs the background subtraction by morphological opening. The parameter is set as (x,y) where x and y are the diameter of an ellipsoid of a size close to the typical object detected in pixels. The intensity of the signal is greatly reduced after the filtering, but the signal-to-noise ration is increased:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClearMap.ImageProcessing.BackgroundRemoval</span> <span class="kn">as</span> <span class="nn">bgr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataBGR</span> <span class="o">=</span> <span class="n">bgr</span><span class="o">.</span><span class="n">removeBackground</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">asype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">dataBGR</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">));</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-4.py">Source code</a>, <a class="reference external" href=".//imageanalysis-4.png">png</a>, <a class="reference external" href=".//imageanalysis-4.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-4.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-4.png" src="_images/imageanalysis-4.png" />
</div>
<p>Note that if the background feature size is chosen too small, this may result in removal of cells:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dataBGR</span> <span class="o">=</span> <span class="n">bgr</span><span class="o">.</span><span class="n">removeBackground</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">dataBGR</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">));</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-5.py">Source code</a>, <a class="reference external" href=".//imageanalysis-5.png">png</a>, <a class="reference external" href=".//imageanalysis-5.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-5.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-5.png" src="_images/imageanalysis-5.png" />
</div>
</div>
<div class="section" id="image-filter">
<h2>Image Filter<a class="headerlink" href="#image-filter" title="Permalink to this headline">¶</a></h2>
<p>A useful feature is to filter an image. Here the
<code class="xref py py-mod docutils literal"><span class="pre">ClearMap.Imageprocessing.Filter</span></code> package can be used.</p>
<p>To detect cells center, the difference of Gaussians filter is a powerful way to increase the contrast between the cells and the background. The size is set as (x,y,z), and usually x, y and z are about the typical size in pixels of the detected object. As after the background subtraction, the intensity of the signal is again reduced after the filtering, but the signal-to-noise ration is dramatically increased:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ClearMap.ImageProcessing.Filter.DoGFilter</span> <span class="kn">import</span> <span class="n">filterDoG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataDoG</span> <span class="o">=</span> <span class="n">filterDoG</span><span class="p">(</span><span class="n">dataBGR</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotTiling</span><span class="p">(</span><span class="n">dataDoG</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">));</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-6.py">Source code</a>, <a class="reference external" href=".//imageanalysis-6.png">png</a>, <a class="reference external" href=".//imageanalysis-6.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-6.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-6.png" src="_images/imageanalysis-6.png" />
</div>
</div>
<div class="section" id="maxima-detection">
<h2>Maxima Detection<a class="headerlink" href="#maxima-detection" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="api/ClearMap.ImageProcessing.html#module-ClearMap.ImageProcessing.MaximaDetection" title="ClearMap.ImageProcessing.MaximaDetection"><code class="xref py py-mod docutils literal"><span class="pre">ClearMap.ImageProcessing.MaximaDetection</span></code></a> module contains a set
of useful functions for the detection of local maxima.
A labeled image can be visualized using the
<a class="reference internal" href="api/ClearMap.Visualization.html#ClearMap.Visualization.Plot.plotOverlayLabel" title="ClearMap.Visualization.Plot.plotOverlayLabel"><code class="xref py py-func docutils literal"><span class="pre">ClearMap.Visualization.Plot.plotOverlayLabel()</span></code></a> routine.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ClearMap.ImageProcessing.MaximaDetection</span> <span class="kn">import</span> <span class="n">findExtendedMaxima</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataMax</span> <span class="o">=</span> <span class="n">findExtendedMaxima</span><span class="p">(</span><span class="n">dataDoG</span><span class="p">,</span> <span class="n">hMax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">10</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotOverlayLabel</span><span class="p">(</span>  <span class="n">dataDoG</span> <span class="o">/</span> <span class="n">dataDoG</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">dataMax</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">),</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-7.py">Source code</a>, <a class="reference external" href=".//imageanalysis-7.png">png</a>, <a class="reference external" href=".//imageanalysis-7.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-7.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-7.png" src="_images/imageanalysis-7.png" />
</div>
<p>Its easier to see when zoomed in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotOverlayLabel</span><span class="p">(</span><span class="n">dataDoG</span> <span class="o">/</span> <span class="n">dataDoG</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">dataMax</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">),</span> \
<span class="gp">&gt;&gt;&gt; </span>                     <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-8.py">Source code</a>, <a class="reference external" href=".//imageanalysis-8.png">png</a>, <a class="reference external" href=".//imageanalysis-8.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-8.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-8.png" src="_images/imageanalysis-8.png" />
</div>
<p>Note that for some cells, a maxima label in this subset might not be visible as
maxima are detected in the entire image in 3D and the actual maxima
might lie in layers not shown above or below the current planes.</p>
<p>Once the maxima are detected the cell coordinates can be determined:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ClearMap.ImageProcessing.MaximaDetection</span> <span class="kn">import</span> <span class="n">findCenterOfMaxima</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cells</span> <span class="o">=</span> <span class="n">findCenterOfMaxima</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataMax</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3670, 3)</span>
</pre></div>
</div>
<p>We can also overlay the cell coordinates in an image:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotOverlayPoints</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-9.py">Source code</a>, <a class="reference external" href=".//imageanalysis-9.png">png</a>, <a class="reference external" href=".//imageanalysis-9.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-9.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-9.png" src="_images/imageanalysis-9.png" />
</div>
</div>
<div class="section" id="cell-shape-detection">
<h2>Cell Shape Detection<a class="headerlink" href="#cell-shape-detection" title="Permalink to this headline">¶</a></h2>
<p>Finally once the cell centers are detected the
<code class="xref py py-mod docutils literal"><span class="pre">ClearMap.ImageProcessing.CellShapedetection</span></code> module can be used to detect
the cell shape via a watershed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ClearMap.ImageProcessing.CellSizeDetection</span> <span class="kn">import</span> <span class="n">detectCellShape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataShape</span> <span class="o">=</span> <span class="n">detectCellShape</span><span class="p">(</span><span class="n">dataDoG</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">15</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plotOverlayLabel</span><span class="p">(</span><span class="n">dataDoG</span> <span class="o">/</span> <span class="n">dataDoG</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">dataShape</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-10.py">Source code</a>, <a class="reference external" href=".//imageanalysis-10.png">png</a>, <a class="reference external" href=".//imageanalysis-10.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-10.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-10.png" src="_images/imageanalysis-10.png" />
</div>
<p>Now we can perform some measurements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ClearMap.ImageProcessing.CellSizeDetection</span> <span class="kn">import</span> <span class="n">findCellSize</span><span class="p">,</span>\
<span class="gp">&gt;&gt;&gt; </span>                                                       <span class="n">findCellIntensity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cellSizes</span> <span class="o">=</span> <span class="n">findCellSize</span><span class="p">(</span><span class="n">dataShape</span><span class="p">,</span> <span class="n">maxLabel</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cellIntensities</span> <span class="o">=</span> <span class="n">findCellIntensity</span><span class="p">(</span><span class="n">dataBGR</span><span class="p">,</span> <span class="n">dataShape</span><span class="p">,</span> <span class="n">maxLabel</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<p>and plot those:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cellSizes</span><span class="p">,</span> <span class="n">cellIntensities</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;cell size [voxel]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;cell intensity [au]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//imageanalysis-11.py">Source code</a>, <a class="reference external" href=".//imageanalysis-11.png">png</a>, <a class="reference external" href=".//imageanalysis-11.hires.png">hires.png</a>, <a class="reference external" href=".//imageanalysis-11.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/imageanalysis-11.png" src="_images/imageanalysis-11.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api/ClearMap.html" title="ClearMap package"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial"
             >previous</a> |</li>
       <li><a href="index.html">home</a>|&nbsp;</li>
       <li><a href="search.html">search</a>|&nbsp;</li>
       <li><a href="api/ClearMap.html">documentation </a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016 Christoph Kirst.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
  </body>
</html>